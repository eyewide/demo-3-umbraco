@using Umbraco.Cms.Web.Common.PublishedModels;
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<ContentModels.OfferPage>
@using ContentModels = Umbraco.Cms.Web.Common.PublishedModels;
@using Umbraco.Cms.Core.Models;
@using Umbraco.Cms.Core.Models.Blocks;

@{
    Layout = "Master.cshtml";

    var root = Model.Root();

    // === BOOKING URL (correct Link type) ===
    Link bookingUrl = null;

    if (Model.HasValue("offerBookingLink"))
    {
        bookingUrl = Model.Value<Link>("offerBookingLink");
    }
    else if (root != null && root.HasValue("bookingLink"))
    {
        bookingUrl = root.Value<Link>("bookingLink");
    }

    // === CONTENT FIELDS ===
    var offerTitle = Model.Value<string>("offerTitle") ?? string.Empty;
    var offerBodyText = Model.Value<string>("offerBodyText") ?? string.Empty;

    // Blocks
    var blockSections = Model.Value<IEnumerable<BlockListItem>>("bodySections");
}
    

<section class="py-offset" id="anchor-section">
    <div class="col-11 col-xl-10 mx-auto">
        <div class="content-max-width text-content">

            @* TITLE *@
            @if (!string.IsNullOrWhiteSpace(offerTitle))
            {
                <h1>@Html.Raw(offerTitle)</h1>
            }

            @* BODY TEXT *@
            @if (!string.IsNullOrWhiteSpace(offerBodyText))
            {
                @Html.Raw(offerBodyText)
            }

            @* BOOK NOW BUTTON — SHOW ONLY IF URL EXISTS *@
            @if (bookingUrl != null && !string.IsNullOrWhiteSpace(bookingUrl.Url))
            {
                <a href="@bookingUrl.Url"
                   target="@bookingUrl.Target"
                   class="btn btn--book mt-4"
                   title="@Umbraco.GetDictionaryValue("ButtonBookNow")">
                    @Umbraco.GetDictionaryValue("ButtonBookNow")
                </a>
            }

        </div>
    </div>
</section>


@if (blockSections?.Any() == true)
{
    foreach (var block in blockSections)
    {
        var content = block.Content;
        @await Html.PartialAsync("~/Views/Partials/blockList/Components/" + content.ContentType.Alias + ".cshtml", block)
    }
}

@if (Model.Level >= 3)
{
    @await Html.PartialAsync("MyBlocks/other-pagesBoxes")
}
